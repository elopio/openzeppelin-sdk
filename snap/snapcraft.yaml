name: openzeppelin
base: core18
version: git
summary: OpenZeppelin commmand-line interface
description: |
  OpenZeppelin SDK is a platform to develop, deploy and operate smart
  contract projects on Ethereum and every other EVM and eWASM-powered
  blockchain.

grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict

apps:
  openzeppelin:
    command: $SNAP/usr/local/bin/node $SNAP/bin/oz-cli.js
    environment: 
      NODE_PATH: $SNAP/node_modules 
    plugs: [network]

parts:
  openzeppelin:
    source: .
    # XXX Cannot use the nodejs plugin because of https://pad.lv/1694642
    # --elopio - 2019-08-05
    plugin: dump
    build-packages: [make, g++, python]
    override-build: |
      export PATH=$SNAPCRAFT_STAGE/usr/local/bin/:$PATH
      cd packages/cli
      # FIXME these packages should be in the package.json
      # --elopio - 2019-08-05
      npm install web3-eth web3-eth-contract
      # XXX workaround for https://github.com/OpenZeppelin/openzeppelin-sdk/issues/929
      # --elopio - 2019-08-06
      rm -rf node_modules/websocket/.git
      rm -rf node_modules/web3/node_modules/websocket/.git
      npm install --unsafe-perm
      cp -r lib $SNAPCRAFT_PART_INSTALL
      cp -r node_modules $SNAPCRAFT_PART_INSTALL
    after: [node]
  node:
    plugin: autotools
    source: https://nodejs.org/dist/v10.16.1/node-v10.16.1.tar.gz
    build-packages: [g++, make, python]
